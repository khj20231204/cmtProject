<!DOCTYPE html>
	<html xmlns:th="http://www.thymeleaf.org" 
	      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head>
		<!-- <link rel="shortcut icon" href="/assets/images/logo/favicon.png" type="image/x-icon"> -->
	    
	    <!-- 기본 메타 정보 -->
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>수주 등록</title>
    
    <title>Cmt</title>
	<style>
         body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: auto;
        }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .form-group label {
            width: 120px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .search-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            margin-left: 5px;
            border-radius: 5px;
        }
        .search-btn:hover {
            background-color: #0056b3;
        }
        .date-container {
            display: flex;
            align-items: center;
        }
        .date-container input {
            flex: 1;
        }
        .calendar-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px;
            cursor: pointer;
            margin-left: 5px;
            border-radius: 5px;
        }
        
        .searchBtn { background:dodgerblue; color: white; }
	    .requestBtn { background: purple; color: white; }
	    .completeBtn { background: green; color: white; }
	    .cancelBtn { background: red; color: white; }
	    .excelBtn { background: darkblue; color: white; }
	    .helpBtn { background: orange; color: white; }
    </style>
</head>
<body>

    <div layout:fragment="content">
   	<form th:action="@{/sales/soregister}" method="post" th:object="${salesOrder}">
		 <div class="container">
        	<h2>수주 정보 입력</h2>
	        <div class="form-group">
	            <label>거래처명 *</label>
	            <!--<select id="cltSelected" th:field="*{cltCode}">
					<option th:each="clt : ${cltList}"
					th:value="${clt.cltCode}"
					th:text="${clt.cltName}">
					</option>
				</select>-->
	        </div>
	         <div class="form-group">
	            <label>제품 *</label>
	            <select id="productSelected" th:filed="*{pdtCode}">
	                <option th:each="product : ${productList}"
						th:value="${product.pdtCode}"
						th:text="${product.pdtName}">적용</option>
	            </select>
	        </div>
	        <div class="form-group">
	            <label>수주번호 *</label><!-- select로 -->
	            <input type="text" th:value="${nextSeq}" th:readonly="true">
	        </div>
	        <div class="form-group">
	            <label>수주코드 *</label><!-- 자동생성 -->
	            <input type="text" th:value="${soCode}" th:readonly="true">
	        </div>
	        <div class="form-group date-container">
	            <label>수주일자 *</label>
	            <input type="date">
	        </div>
	         <div class="form-group date-container">
	            <label>예상 출하일자 *</label>
	            <input type="date">
	        </div>
			<div class="form-group">
	           <label>수량 *</label>
	            <input type="text" placeholder="숫자입력" th:filed="*{soQuantity}">
	        </div>
			<div class="form-group">
				<label>출고단가 *</label>
				<input type="text" placeholder="숫자입력" th:filed="*{pdtShippingPrice}">
	        </div>
			<div class="form-group">
				<label>진행 상태 *</label>
				<select id="productSelected">
	                <option th:each="soStatus : ${soStatus}"
						th:value="${soStatus}"
						th:text="${soStatus}">적용</option>
	            </select>
	        </div>
	      <div class="form-group">
	        <label>담당자 *</label>
	        <select id="deptSelected">
			<option th:each="dept : ${commListDetp}"
				th:value="${dept.cmnDetailCode}"
				th:text="${dept.cmnDetailName}">
			</option>
			</select>
			<select id="posSelected">
				<option th:each="pos : ${commListPosition}"
					th:value="${pos.cmnDetailCode}"
					th:text="${pos.cmnDetailName}">
				</option>
			</select>
			<select id="empSelected">
			</select>
	       </div>
	        
    	</div>
    	
    	<div style="text-align: center;">
    		<button type="submit" class="requestBtn">입력</button>
    		<button type="button" class="excelBtn">취소</button>
    	</div>
    	
		</form>	
    </div> <!-- layout:fragment="content" -->
   	
	<th:block layout:fragment="script">
		<script src="https://code.jquery.com/jquery.min.js"></script>
	    <script>
	    	$(document).ready(function(){
	    		
	    		let deptCode = $("#deptSelected").val();
	    		let posCode = $("#posSelected").val();
				
				let code = {
	    			"deptCode" : deptCode,
	    			"posCode" : posCode
	    		};
	    		
				ajaxExe(code);
				
	    		$("#deptSelected").on("change",function(){
	    			//alert("dept변경");
	    			deptCode = $("#deptSelected").val();
					posCode = $("#posSelected").val();
					
					code = {
		    			"deptCode" : deptCode,
		    			"posCode" : posCode
		    		};
					
					ajaxExe(code);
	    		})
	    		
	    		$("#posSelected").on("change", function(){
					deptCode = $("#deptSelected").val();
					posCode = $("#posSelected").val();
					
					code = {
		    			"deptCode" : deptCode,
		    			"posCode" : posCode
		    		};
					
					ajaxExe(code);
	    		})

				function ajaxExe(code){
					if(code){
						$.ajax({
			    			url:"/sales/getEmpName",
			    			type:"GET",
			    			data: code,
			    			success: function(data){
			    				let $select = $("#empSelected");
								
								//$select.find("option:not(:first)").remove();
								$select.find("option").remove();
								
								data.forEach(emp => {
									console.log(emp)
									let option = `<option value="${emp.EMP_ID}">${emp.EMP_NAME}</option>`;
									$select.append(option);								
								});
			    			},
			    			error: function(error){
			    				alert(error);
			    			}
			    		}); 
					}
				}
	    	});
	    </script>
	</th:block>
</body>

</html>


