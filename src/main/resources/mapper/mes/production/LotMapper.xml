<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ProductMapper.java 경로로 클래스명 ProductMapper까지 입력 --> 
<mapper namespace="com.example.cmtProject.mapper.mes.production.LotMapper">
	<!-- LOTNO의 최대값 -->
	<select id="getLotNo" resultType="int">
		SELECT MAX(NVL(LOT_NO,0)) FROM LOT
	</select>
	
	<select id="getLotOrderPrcType" resultType="com.example.cmtProject.dto.mes.production.LotOrderDTO">
		SELECT
			SUBSTR(LOT_CODE, 14, 2) AS PRC_TYPE,
			NVL(MAX(TO_NUMBER(SUBSTR(LOT_CODE, 17))),0) AS MAX_SEQ
		FROM LOT
		WHERE LOT_CODE LIKE 'LOT-' || #{todayStr} || '-%'
		  AND SUBSTR(LOT_CODE, 14, 2) = #{type}
		GROUP BY SUBSTR(LOT_CODE, 14, 2)
	</select>
	
</mapper>